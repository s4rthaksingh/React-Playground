import { useEffect, useState } from "react";
import "./App.css";

function abbreviateNumber(number, locale = 'en-US', options = {}) {
  const suffixes = ['', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc', 'No', 'Dc'];
  const defaultOptions = {
    maximumFractionDigits: 1
  };
  const opts = { ...defaultOptions, ...options };

  let num;
  if (typeof number === 'bigint') {
    num = number;
  } else if (typeof number === 'number') {
    num = BigInt(Math.floor(number));
  } else {
    throw new Error('Input must be a number or BigInt');
  }

  let magnitude = 0n;
  let divisor = 1000n;

  while (num >= divisor && magnitude < BigInt(suffixes.length - 1)) {
    num /= 1000n;
    magnitude++;
  }
  const displayNumber = Number(num);

  const formattedNumber = displayNumber.toLocaleString(locale, opts);

  return `${formattedNumber}${suffixes[Number(magnitude)]}`;
}


const propertyDict = {
  "Tent": { income: 0.5, price: 50 },
  "Apartment": { income: 1, price: 100 },
  "Cottage": { income: 3, price: 300 },
  "Condo": { income: 5, price: 500 },
  "House": { income: 8, price: 800 },
  "Townhouse": { income: 15, price: 1500 },
  "Villa": { income: 30, price: 3000 },
  "Shop": { income: 50, price: 5000 },
  "Cafe": { income: 60, price: 6000 },
  "Restaurant": { income: 120, price: 12000 },
  "Bakery": { income: 160, price: 16000 },
  "Gym": { income: 200, price: 20000 },
  "Office": { income: 300, price: 30000 },
  "Warehouse": { income: 400, price: 40000 },
  "Hotel": { income: 500, price: 50000 },
  "Factory": { income: 600, price: 60000 },
  "Stadium": { income: 1800, price: 180000 },
  "Skyscraper": { income: 2500, price: 250000 },
  "DataCenter": { income: 3000, price: 300000 },
  "Airport": { income: 10000, price: 1000000 },
  "Seaport": { income: 15000, price: 1500000 },
  "Spaceport": { income: 25000, price: 2500000 },
  "Megamall": { income: 40000, price: 4000000 },
  "Arcology": { income: 60000, price: 6000000 },
  "Biosphere": { income: 80000, price: 8000000 },
  "Fusion": { income: 120000, price: 12000000 },
  "Megacity": { income: 200000, price: 20000000 },
  "SpaceElevator": { income: 300000, price: 30000000 },
  "Terraformer": { income: 500000, price: 50000000 },
  "DysonSphere": { income: 1000000, price: 100000000 },
  "OrbitalRing": { income: 2000000, price: 200000000 },
  "Nanofactory": { income: 4000000, price: 400000000 },
  "AIHub": { income: 6000000, price: 600000000 },
  "QuantumLab": { income: 9000000, price: 900000000 },
  "WormholeGate": { income: 15000000, price: 1500000000 },
  "PlanetaryForge": { income: 25000000, price: 2500000000 },
  "GalacticBank": { income: 40000000, price: 4000000000 },
  "StarLifter": { income: 60000000, price: 6000000000 },
  "SolarCollector": { income: 100000000, price: 10000000000 },
  "AstroCity": { income: 150000000, price: 15000000000 },
  "OrbitalHabitat": { income: 200000000, price: 20000000000 },
  "ExoplanetBase": { income: 300000000, price: 30000000000 },
  "StellarForge": { income: 500000000, price: 50000000000 },
  "DysonNet": { income: 800000000, price: 80000000000 },
  "HyperShipyard": { income: 1200000000, price: 120000000000 },
  "TimeReactor": { income: 1800000000, price: 180000000000 },
  "DimensionalHub": { income: 2500000000, price: 250000000000 },
  "GalaxyFarm": { income: 4000000000, price: 400000000000 },
  "UniverseFactory": { income: 6000000000, price: 600000000000 },
  "RealityForge": { income: 9000000000, price: 900000000000 },
  "InfinityCore": { income: 15000000000, price: 1500000000000 },
  "MultiverseAnchor": { income: 25000000000, price: 2500000000000 },
  "OmegaEngine": { income: 40000000000, price: 4000000000000 },
  "SingularityPlant": { income: 60000000000, price: 6000000000000 },
  "GodMachine": { income: 100000000000, price: 10000000000000 },
  "CosmosArchitect": { income: 150000000000, price: 15000000000000 },
  "MetaForge": { income: 200000000000, price: 20000000000000 },
  "HyperDyson": { income: 300000000000, price: 30000000000000 },
  "DimensionMiner": { income: 500000000000, price: 50000000000000 },
  "VoidHarvester": { income: 800000000000, price: 80000000000000 },
  "EternalForge": { income: 1200000000000, price: 120000000000000 },
  "OmniFabricator": { income: 1800000000000, price: 180000000000000 },
  "InfinityTower": { income: 2500000000000, price: 250000000000000 },
  "HyperverseHub": { income: 4000000000000, price: 400000000000000 },
  "OmegaForge": { income: 6000000000000, price: 600000000000000 },
  "SingularityCore": { income: 9000000000000, price: 900000000000000 },
  "TranscendenceHub": { income: 15000000000000, price: 1500000000000000 },
  "EternitySpire": { income: 25000000000000, price: 2500000000000000 },
  "CosmicForge": { income: 40000000000000, price: 4000000000000000 },
  "InfinityMatrix": { income: 60000000000000, price: 6000000000000000 },
  "RealityAnchor": { income: 90000000000000, price: 9000000000000000 },
  "VoidEngine": { income: 150000000000000, price: 15000000000000000 },
  "EventHorizonHub": { income: 250000000000000, price: 25000000000000000 },
  "QuantumSingularity": { income: 400000000000000, price: 40000000000000000 },
  "OmegaConstruct": { income: 600000000000000, price: 60000000000000000 },
  "HyperRealityForge": { income: 900000000000000, price: 90000000000000000 },
  "MultiverseEngine": { income: 1500000000000000, price: 150000000000000000 },
  "OmniverseCore": { income: 2500000000000000, price: 250000000000000000 },
  "InfinityForge": { income: 4000000000000000, price: 400000000000000000 },
  "GodForge": { income: 6000000000000000, price: 600000000000000000 },
  "CosmosCore": { income: 9000000000000000, price: 900000000000000000 },
  "UltimateConstruct": { income: 15000000000000000, price: 1500000000000000000 },
  "AbsoluteMachine": { income: 25000000000000000, price: 2500000000000000000 },
  "InfinityEngine": { income: 40000000000000000, price: 4000000000000000000 },
  "RealityOverlord": { income: 60000000000000000, price: 6000000000000000000 },
  "UniverseOverseer": { income: 90000000000000000, price: 9000000000000000000 },
  "CosmosOverlord": { income: 100000000000000000, price: 10000000000000000000 },
  "RealitySovereign": { income: 150000000000000000, price: 15000000000000000000 },
  "InfinityOverlord": { income: 200000000000000000, price: 20000000000000000000 },
  "Omniscience": { income: 300000000000000000, price: 30000000000000000000 },
  "Omnipotence": { income: 500000000000000000, price: 50000000000000000000 },
  "EternityEngine": { income: 750000000000000000, price: 75000000000000000000 },
  "Chronoverse": { income: 1000000000000000000, price: 100000000000000000000 },
  "AlphaOmega": { income: 1500000000000000000, price: 150000000000000000000 },
  "Primordial": { income: 2000000000000000000, price: 200000000000000000000 },
  "Allfather": { income: 3000000000000000000, price: 300000000000000000000 },
  "SingularityOverlord": { income: 5000000000000000000, price: 500000000000000000000 },
  "MetaOverseer": { income: 7500000000000000000, price: 750000000000000000000 },
  "ParadoxCore": { income: 10000000000000000000, price: 1000000000000000000000 },
  "AnsibleGrid": { income: 15000000000000000000, price: 1500000000000000000000 },
  "Continuum": { income: 20000000000000000000, price: 2000000000000000000000 },
  "Overmind": { income: 30000000000000000000, price: 3000000000000000000000 },
  "Pantheon": { income: 50000000000000000000, price: 5000000000000000000000 },
  "SingularityArray": { income: 75000000000000000000, price: 7500000000000000000000 },
  "OmniMatrix": { income: 100000000000000000000, price: 10000000000000000000000 },
  "Hypercosm": { income: 150000000000000000000, price: 15000000000000000000000 },
  "Totality": { income: 200000000000000000000, price: 20000000000000000000000 },
  "Starforge": { income: 600000000000000000000, price: 30000000000000000000000 },
  "Neutronium": { income: 1200000000000000000000, price: 60000000000000000000000 },
  "Voidcore": { income: 2400000000000000000000, price: 120000000000000000000000 },
  "Aetherium": { income: 4800000000000000000000, price: 240000000000000000000000 },
  "Singularis": { income: 9600000000000000000000, price: 480000000000000000000000 },
  "Omnilium": { income: 19200000000000000000000, price: 960000000000000000000000 },
  "Chronomine": { income: 38400000000000000000000, price: 1920000000000000000000000 },
  "Mythril": { income: 76800000000000000000000, price: 3840000000000000000000000 },
  "Nebulith": { income: 153600000000000000000000, price: 7680000000000000000000000 },
  "Quasarix": { income: 307200000000000000000000, price: 15360000000000000000000000 },
  "Celestium": { income: 614400000000000000000000, price: 30720000000000000000000000 },
  "Astralite": { income: 1228800000000000000000000, price: 61440000000000000000000000 },
  "Novacore": { income: 2457600000000000000000000, price: 122880000000000000000000000 },
  "Zenithium": { income: 4915200000000000000000000, price: 245760000000000000000000000 },
  "Eclipseon": { income: 9830400000000000000000000, price: 491520000000000000000000000 },
  "Aurorium": { income: 19660800000000000000000000, price: 983040000000000000000000000 },
  "Oblivion": { income: 39321600000000000000000000, price: 1966080000000000000000000000 },
  "Paragon": { income: 78643200000000000000000000, price: 3932160000000000000000000000 },
  "Axiom": { income: 157286400000000000000000000, price: 7864320000000000000000000000 },
  "Apotheon": { income: 314572800000000000000000000, price: 15728640000000000000000000000 },
  "Celestarch": { income: 629145600000000000000000000, price: 31457280000000000000000000000 },
"Eternarch": { income: 1258291200000000000000000000, price: 62914560000000000000000000000 },
"Oblivarch": { income: 2516582400000000000000000000, price: 125829120000000000000000000000 },
"Nyxforge": { income: 5033164800000000000000000000, price: 251658240000000000000000000000 },
"Cosmorythm": { income: 10066329600000000000000000000, price: 503316480000000000000000000000 },
"Zephyros": { income: 20132659200000000000000000000, price: 1006632960000000000000000000000 },
"Aetherion": { income: 40265318400000000000000000000, price: 2013265920000000000000000000000 },
"Chronovast": { income: 80530636800000000000000000000, price: 4026531840000000000000000000000 },
"Empyreon": { income: 161061273600000000000000000000, price: 8053063680000000000000000000000 },
"Solaryn": { income: 322122547200000000000000000000, price: 16106127360000000000000000000000 },
"Noctyros": { income: 644245094400000000000000000000, price: 32212254720000000000000000000000 },
"Divinitas": { income: 1288490188800000000000000000000, price: 64424509440000000000000000000000 },
"Obscuron": { income: 2576980377600000000000000000000, price: 128849018880000000000000000000000 },
"Luminarch": { income: 5153960755200000000000000000000, price: 257698037760000000000000000000000 },
"Astralis": { income: 10307921510400000000000000000000, price: 515396075520000000000000000000000 },
"Netherion": { income: 20615843020800000000000000000000, price: 1030792151040000000000000000000000 },
"Infinitum": { income: 41231686041600000000000000000000, price: 2061584302080000000000000000000000 },
"Mythralis": { income: 82463372083200000000000000000000, price: 4123168604160000000000000000000000 },
"Oblivis": { income: 164926744166400000000000000000000, price: 8246337208320000000000000000000000 },
"Xytheron": { income: 329853488332800000000000000000000, price: 16492674416640000000000000000000000 },
"Arcovast": { income: 659706976665600000000000000000000, price: 32985348833280000000000000000000000 },
"Zenorith": { income: 1319413953331200000000000000000000, price: 65970697666560000000000000000000000 },
"Nebryon": { income: 2638827906662400000000000000000000, price: 131941395333120000000000000000000000 },
"Valyros": { income: 5277655813324800000000000000000000, price: 263882790666240000000000000000000000 },
"Omnirex": { income: 10555311626649600000000000000000000, price: 527765581332480000000000000000000000 },
"Aurathos": { income: 21110623253299200000000000000000000, price: 1055531162664960000000000000000000000 },
"Tenebros": { income: 42221246506598400000000000000000000, price: 2111062325329920000000000000000000000 },
"Etherion": { income: 84442493013196800000000000000000000, price: 4222124650659840000000000000000000000 },
"Magnion": { income: 168884986026393600000000000000000000, price: 8444249301319680000000000000000000000 },
"Veyloris": { income: 337769972052787200000000000000000000, price: 16888498602639360000000000000000000000 },
"Omnivast": { income: 675539944105574400000000000000000000, price: 33776997205278720000000000000000000000 },
"Exelion": { income: 1351079888211148800000000000000000000, price: 67553994410557440000000000000000000000 },
"Phantyros": { income: 2702159776422297600000000000000000000, price: 135107988821114880000000000000000000000 },
"Kytheris": { income: 5404319552844595200000000000000000000, price: 2702159776422297600000000000000000000 },
"Omnion": { income: 10808639105689190400000000000000000000, price: 54043195528445952000000000000000000000 },
"Draconis": { income: 21617278211378380800000000000000000000, price: 108086391056891904000000000000000000000 },
"Galadris": { income: 43234556422756761600000000000000000000, price: 216172782113783808000000000000000000000 },
"Oblivaris": { income: 86469112845513523200000000000000000000, price: 432345564227567616000000000000000000000 },
"Stellaris": { income: 172938225691027046400000000000000000000, price: 864691128455135232000000000000000000000 },
"Voidaris": { income: 345876451382054092800000000000000000000, price: 1729382256910270464000000000000000000000 },
"Eryndor": { income: 691752902764108185600000000000000000000, price: 3458764513820540928000000000000000000000 },
"Xenoryth": { income: 1383505805528216371200000000000000000000, price: 6917529027641081856000000000000000000000 },
"Thalyros": { income: 2767011611056432742400000000000000000000, price: 13835058055282163712000000000000000000000 },
"Omnivale": { income: 5534023222112865484800000000000000000000, price: 27670116110564327424000000000000000000000 },
"Zephyrosyne": { income: 11068046444225730969600000000000000000000, price: 55340232221128654848000000000000000000000 },
"Aurathriel": { income: 22136092888451461939200000000000000000000, price: 110680464442257309696000000000000000000000 },
"Nytheris": { income: 44272185776902923878400000000000000000000, price: 221360928884514619392000000000000000000000 },
"Oblivionis": { income: 88544371553805847756800000000000000000000, price: 442721857769029238784000000000000000000000 },
"Cosmythos": { income: 177088743107611695513600000000000000000000, price: 885443715538058477568000000000000000000000 },
"Infinitara": { income: 354177486215223391027200000000000000000000, price: 1770887431076116955136000000000000000000000 },
"Elyndros": { income: 708354972430446782054400000000000000000000, price: 3541774862152233910272000000000000000000000 },
"Zerathos": { income: 1416709944860893564108800000000000000000000, price: 7083549724304467820544000000000000000000000 },
"Omnionyx": { income: 2833419889721787128217600000000000000000000, price: 14167099448608935641088000000000000000000000 },
"Valtheris": { income: 5666839779443574256435200000000000000000000, price: 28334198897217871282176000000000000000000000 },
"Chronoryth": { income: 11333679558887148512870400000000000000000000, price: 56668397794435742564352000000000000000000000 },
"Eternyros": { income: 22667359117774297025740800000000000000000000, price: 113336795588871485128704000000000000000000000 },
"Phasmyth": { income: 45334718235548594051481600000000000000000000, price: 226673591177742970257408000000000000000000000 },
"Omnitheris": { income: 90669436471097188102963200000000000000000000, price: 453347182355485940514816000000000000000000000 },
"Oblivara": { income: 181338872942194376205926400000000000000000000, price: 906694364710971881029632000000000000000000000 },
"Stellithos": { income: 362677745884388752411852800000000000000000000, price: 1813388729421943762059264000000000000000000000 },
"Netherith": { income: 725355491768777504823705600000000000000000000, price: 3626777458843887524118528000000000000000000000 },
"Aetherith": { income: 1450710983537555009647411200000000000000000000, price: 7253554917687775048237056000000000000000000000 },
"Cosmyron": { income: 2901421967075110019294822400000000000000000000, price: 14507109835375550096474112000000000000000000000 },
"Obscyros": { income: 5802843934150220038589644800000000000000000000, price: 29014219670751100192948224000000000000000000000 },
"Empyrios": { income: 11605687868300440077179289600000000000000000000, price: 58028439341502200385896448000000000000000000000 },
"Zephralis": { income: 23211375736600880154358579200000000000000000000, price: 116056878683004400771792896000000000000000000000 },
"Chronyros": { income: 46422751473201760308717158400000000000000000000, price: 232113757366008801543585792000000000000000000000 },
"Omniveth": { income: 92845502946403520617434316800000000000000000000, price: 464227514732017603087171584000000000000000000000 },
"Infyros": { income: 185691005892807041234868633600000000000000000000, price: 928455029464035206174343168000000000000000000000 },
"Oblivynth": { income: 371382011785614082469737267200000000000000000000, price: 1856910058928070412348686336000000000000000000000 },
"Cosmorion": { income: 742764023571228164939474534400000000000000000000, price: 3713820117856140824697372672000000000000000000000 },
"Etheralis": { income: 1485528047142456329878949068800000000000000000000, price: 7427640235712281649394745344000000000000000000000 },
"Nyxaris": { income: 2971056094284912659757898137600000000000000000000, price: 14855280471424563298789490688000000000000000000000 },
"Zephyrel": { income: 5942112188569825319515796275200000000000000000000, price: 29710560942849126597578981376000000000000000000000 },
"Empyrealith": { income: 11884224377139650639031592550400000000000000000000, price: 59421121885698253195157962752000000000000000000000 },
"Oblivarisyn": { income: 23768448754279301278063185100800000000000000000000, price: 118842243771396506390315925504000000000000000000000 },
"Infinitheon": { income: 47536897508558602556126370201600000000000000000000, price: 237684487542793012780631851008000000000000000000000 },
"Omniscend": { income: 95073795017117205112252740403200000000000000000000, price: 475368975085586025561263702016000000000000000000000 },
"Chronovale": { income: 190147590034234410224505480806400000000000000000000, price: 950737950171172051122527404032000000000000000000000 },
"Etheralith": { income: 380295180068468820449010961612800000000000000000000, price: 1901475900342344102245054808064000000000000000000000 },
"Auroralis": { income: 760590360136937640898021923225600000000000000000000, price: 3802951800684688204490109616128000000000000000000000 },
"Oblivithon": { income: 1521180720273875281796043846451200000000000000000000, price: 7605903601369376408980219232256000000000000000000000 },
"Zephyronis": { income: 3042361440547750563592087692902400000000000000000000, price: 15211807202738752817960438464512000000000000000000000 },
"Cosmorythos": { income: 6084722881095501127184175385804800000000000000000000, price: 30423614405477505635920876929024000000000000000000000 },
"Infyrel": { income: 12169445762191002254368350771609600000000000000000000, price: 60847228810955011271841753858048000000000000000000000 },
"Omnivora": { income: 24338891524382004508736701543219200000000000000000000, price: 121694457621910022543683507716096000000000000000000000 },
"Chronyxis": { income: 48677783048764009017473403086438400000000000000000000, price: 243388915243820045087367015432192000000000000000000000 },
"Empyrealon": { income: 97355566097528018034946806172876800000000000000000000, price: 486777830487640090174734030864384000000000000000000000 },
"Oblivryth": { income: 194711132195056036069893612345753600000000000000000000, price: 973555660975280180349468061728768000000000000000000000 },
"Infynith": { income: 389422264390112072139787224691507200000000000000000000, price: 1947111321950560360698936123457536000000000000000000000 },
"Cosmoryn": { income: 778844528780224144279574449383014400000000000000000000, price: 3894222643901120721397872246915072000000000000000000000 },
"Etherivast": { income: 1557689057560448288559148898766028800000000000000000000, price: 7788445287802241442795744493830144000000000000000000000 },
"Omnilyth": { income: 3115378115120896577118297797532057600000000000000000000, price: 15576890575604482885591488987660288000000000000000000000 },
"Zephyronyx": { income: 6230756230241793154236595595064115200000000000000000000, price: 31153781151208965771182977975320576000000000000000000000 },
};


function showProperty(bal, property){
  const last = Object.keys(propertyDict)[Object.keys(propertyDict).length-1]
  if(!propertyDict[property]) return false;
  if(property == last) return bal > propertyDict[last].price;
  else if((propertyDict[property].price < bal/2 || propertyDict[property].price > bal*2)) return false
  else return true;
}

function App() {
  const [bal, setBal] = useState(() => {
    const saved = localStorage.getItem("balance");
    return saved ? parseInt(saved) : 0;
  });
  const [properties, setProperties] = useState(() => {
    const savedProperties = JSON.parse(localStorage.getItem("properties")) || {};
    let beginningProperties = {};
    for(const property in propertyDict) beginningProperties[property] = savedProperties[property] ?? 0;
    return beginningProperties;
  });
  const [income, setIncome] = useState(0);



  useEffect(() => {
    localStorage.setItem("balance", bal.toString());
    localStorage.setItem("properties", JSON.stringify(properties));
  }, [bal, properties]);

  useEffect(() => {
    let addition = 0;
    for(const property in propertyDict){
      addition += propertyDict[property].income * properties[property];
    }
    setIncome(addition);
    const interval = setInterval(() => {
      setBal((currentBal) => currentBal + addition);
    }, 1000);

    return () => clearInterval(interval);
  }, [properties]);

  return (
    <>
      <div className="h-screen w-screen flex flex-col items-center justify-around m-10 p-10">
        <div className="flex flex-col gap-5">
        <p className="text-3xl">
            Balance : ${abbreviateNumber(bal)}
          </p>
          <p className="text-3xl">
            Passive Income : ${abbreviateNumber(income)}/sec
          </p>
        </div>
        <div className="flex flex-col lg:flex-row gap-30 items-center justify-around w-screen p-5">
          <Workplace setBal={setBal} bal={bal} />
          <BuyOption
            setBal={setBal}
            bal={bal}
            properties={properties}
            setProperties={setProperties}
          />
          <Properties properties={properties} bal={bal}/>
        </div>
      </div>
    </>
  );
}

function Workplace({ bal, setBal }) {
  return (
    <>
      <div className="flex flex-col gap-3">
        <h2>Work to earn $1</h2>
        <button
          onClick={() => {
            setBal(bal + 1);
          }}
        >
          Work
        </button>
      </div>
    </>
  );
}

function BuyOption({ bal, setBal, properties, setProperties }) {
  const buyHandler = (p) => {
    if (bal < propertyDict[p].price) return;
    setBal(bal - propertyDict[p].price);
    let newProperties = {
      ...properties,
      [p]: properties[p] + 1,
    };
    setProperties(newProperties);
  };

  return (
    <>
      <div className="flex flex-col gap-2">

      {Object.keys(propertyDict).map((property, index) => {
        if(showProperty(bal, property)) return <button
          style={{ background: bal < propertyDict[property].price && "slategray" }}
          onClick={(e) => buyHandler(e.target.value)}
          value={property}
          key={index}
        >
          Buy {property} (${abbreviateNumber(propertyDict[property].price)})
        </button>;
      })}

</div>
    </>
  );
}

function Properties({ bal, properties }) {
  return (
    <>
      <div>
        Your properties :
        {Object.keys(properties).map((property, index) => {
          if(showProperty(bal, property)) return (
            <li key={index}>
              {property} : {abbreviateNumber(properties[property])}
            </li>
          );
        })}
      </div>
    </>
  );
}

export default App;
